<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fraxy Match Deal Making 2026 Directory</title>

  <!-- Bootstrap 5.3 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

  <style>
    body {
      background-color: #f8f9fa;
      font-family: system-ui, -apple-system, sans-serif;
    }
    .card {
      transition: transform 0.15s, box-shadow 0.15s;
    }
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.12) !important;
    }
    .card-img-top {
      height: 90px;
      object-fit: contain;
      background: #ffffff;
      border-bottom: 1px solid #eee;
      padding: 12px;
    }
    .badge-type {
      font-size: 0.8rem;
    }
    .card-text.about {
      font-size: 0.92rem;
      line-height: 1.45;
      color: #444;
    }
    .footer-links .btn {
      font-size: 0.85rem;
      padding: 0.4rem 0.9rem;
    }
  </style>
</head>
<body>

<div class="container my-5">
  <h1 class="text-center mb-4 fw-bold">AFF Deal Making 2025</h1>
  <p class="text-center text-muted mb-5">Investors • Projects • Representatives</p>

  <!-- Filters -->
  <div class="row g-3 mb-4 justify-content-center">
    <div class="col-md-5 col-lg-4">
      <input type="text" id="searchInput" class="form-control" placeholder="Search company, rep, sector, location...">
    </div>
    <div class="col-md-3 col-lg-2">
      <select id="typeFilter" class="form-select">
        <option value="">All Types</option>
      </select>
    </div>
    <div class="col-md-3 col-lg-2">
      <select id="sectorFilter" class="form-select">
        <option value="">All Sectors</option>
        <option value="Financial Technology">FinTech</option>
        <option value="Healthcare Technology">HealthTech</option>
        <option value="Environment, Energy and Clean Technology">Clean Energy</option>
        <option value="Deep Technology">Deep Tech</option>
        <option value="Consumer">Consumer</option>
        <option value="Digital Entertainment">Media & Ent</option>
        <option value="Manufacturing Technology">Maunf Tech</option>
        <option value="Infrastructure and Real Estate Services">Infra & RE</option>
        <option value="Food and Agriculture">Food & Ag</option>
        <option value="Education">Education</option>
        <!-- add more as needed -->
      </select>
    </div>
  </div>

  <!-- Cards -->
  <div class="row g-4" id="cardsContainer">
    <div class="col-12 text-center py-5">
      <div class="spinner-border text-primary" role="status" style="width:3rem;height:3rem;"></div>
      <p class="mt-3 text-muted">Loading directory...</p>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.0/papaparse.min.js"></script>

<script>
    // === Improved version with dynamic sectors from real data columns ===
    
    const csvUrl = 'https://raw.githubusercontent.com/kahhin23/Financial-Website/main/data.csv';
    
    let allData = [];
    
    function renderCards(data) {
      const container = $('#cardsContainer');
      container.empty();
    
      if (!data || data.length === 0) {
        container.html('<div class="col-12 text-center py-5"><h5 class="text-muted">No matching entries found</h5></div>');
        return;
      }
    
      data.forEach(row => {
        // Company name (try both possible keys)
        const company = (row.Company || row['Company '] || '').trim();
        if (!company || company === 'Company') return;
    
        const logo = row.companyLogos?.trim() 
          ? `<img src="${row.companyLogos}" class="card-img-top" alt="${company} logo">` 
          : '';
    
        const type = (row['Company Type - \nInvestor / Others / Project Owner'] || row['Company Type - Investor / Others / Project Owner'] || '').trim();
        const typeBadge = type ? `<span class="badge bg-secondary badge-type">${type}</span>` : '';
    
        const loc = (row.Location || row['Company Location'] || '').trim() || '—';
        const locationBadge = loc !== '—' ? `<span class="badge bg-info badge-type">${loc}</span>` : '';
    
        // === Dynamic sectors: find all columns that look like sectors and have 'Y' ===
        let sectors = [];
        Object.keys(row).forEach(key => {
          const trimmedKey = key.trim();
          // Look for known sector-like columns
          if (trimmedKey && row[key] === 'Y' && (
            trimmedKey.includes('Financial Technology') ||
            trimmedKey.includes('Deep Technology') ||
            trimmedKey.includes('Environment') ||
            trimmedKey.includes('Healthcare Technology') ||
            trimmedKey.includes('Consumer') ||
            trimmedKey.includes('Digital Entertainment') ||
            trimmedKey.includes('Manufacturing Technology') ||
            trimmedKey.includes('Infrastructure') ||
            trimmedKey.includes('Food and Agriculture') ||
            trimmedKey.includes('Education')
          )) {
            // Clean display name
            let displayName = trimmedKey
              .replace('Financial Technology', 'FinTech')
              .replace('Deep Technology', 'Deep Tech')
              .replace('Environment, Energy and Clean Technology', 'Clean Energy')
              .replace('Healthcare Technology', 'HealthTech')
              .replace('Digital Entertainment and Media', 'Media & Ent')
              .replace('Manufacturing Technology', 'Manuf Tech')
              .replace('Infrastructure and Real Estate Services', 'Infra & RE')
              .replace('Food and Agriculture', 'Food & Ag')
              .replace('Education', 'Education');
            sectors.push(displayName);
          }
        });
    
        const sectorText = sectors.length ? sectors.join(' • ') : '—';
    
        const rep = row.Representative?.trim() 
          ? `${row.Representative} <small class="text-muted">(${row['Representative Title'] || row['Company Sub-Type'] || '—'})</small>` 
          : '—';
    
        const about = row.About?.trim() 
          ? row.About.substring(0, 160) + (row.About.length > 160 ? '...' : '') 
          : 'No description available.';
    
        const websiteLink = row['Company Website']?.trim() 
          ? `<a href="${row['Company Website']}" target="_blank" class="btn btn-sm btn-outline-primary">Website</a>` 
          : '';
    
        const socialLink = row['Social Media']?.trim() 
          ? `<a href="${row['Social Media']}" target="_blank" class="btn btn-sm btn-outline-secondary ms-2">Social</a>` 
          : '';
    
        const card = `
          <div class="col-lg-4 col-md-6">
            <div class="card h-100 shadow-sm">
              ${logo}
              <div class="card-body d-flex flex-column">
                <h5 class="card-title mb-2">${company}</h5>
                <div class="mb-3">
                  ${typeBadge} ${locationBadge}
                </div>
                <div class="small mb-2">
                  <strong>Rep:</strong> ${rep}
                </div>
                <div class="small mb-3">
                  <strong>Targeted Sectors:</strong><br>${sectorText}
                </div>
                <p class="card-text about flex-grow-1">${about}</p>
              </div>
              <div class="card-footer bg-white border-0 pt-0 footer-links text-center">
                ${websiteLink}${socialLink}
              </div>
            </div>
          </div>
        `;
    
        container.append(card);
      });
    }
    
    function applyFilters() {
      const search = ($('#searchInput').val() || '').toLowerCase().trim();
      const typeVal = $('#typeFilter').val();
      const sectorKey = $('#sectorFilter').val();
    
      const filtered = allData.filter(row => {
        const company = (row.Company || row['Company '] || '').trim();
        if (!company) return false;
    
        const fullText = [
          company,
          row.Representative || '',
          row.Location || '',
          row['Company Location'] || '',
          row['Company Type - \nInvestor / Others / Project Owner'] || row['Company Type - Investor / Others / Project Owner'] || '',
          row.About || ''
        ].join(' ').toLowerCase();
    
        let match = true;
        if (search) match = match && fullText.includes(search);
        if (typeVal) {
          const type = row['Company Type - \nInvestor / Others / Project Owner'] || row['Company Type - Investor / Others / Project Owner'] || '';
          match = match && type === typeVal;
        }
        if (sectorKey) match = match && (row[sectorKey] === 'Y' || row[sectorKey.trim()] === 'Y');
    
        return match;
      });
    
      renderCards(filtered);
    }
    
    // Load data
    Papa.parse(csvUrl, {
      download: true,
      header: false,           // Important: headers are not in row 1
      skipEmptyLines: true,
      complete: function(results) {
        if (results.errors.length > 0) {
          console.error('Parsing errors:', results.errors);
        }
    
        const rawRows = results.data;
    
        if (rawRows.length < 3) {
          console.error('CSV too short');
          return;
        }
    
        // Headers are in row 2 (index 2)
        const headers = rawRows[2].map(h => (h || '').trim().replace(/\n/g, ' '));
    
        // Data starts from row 3 (index 3)
        allData = rawRows.slice(3).map(rowArray => {
          const obj = {};
          rowArray.forEach((val, idx) => {
            if (idx < headers.length && headers[idx]) {
              obj[headers[idx]] = (val || '').trim();
            }
          });
          return obj;
        }).filter(obj => {
          const company = obj['Company'] || obj['Company '] || '';
          return company && company !== 'Company';
        });
    
        console.log('Parsed valid entries:', allData.length);
        if (allData.length > 0) {
          console.log('Sample entry:', allData[0]);
        }
    
        // Populate type filter
        const typeKey = headers.find(h => h.includes('Investor / Others / Project Owner')) || '';
        if (typeKey) {
          const types = [...new Set(allData.map(r => r[typeKey]?.trim()).filter(Boolean))];
          types.sort().forEach(t => {
            $('#typeFilter').append(`<option value="${t}">${t}</option>`);
          });
        }
    
        renderCards(allData);
      },
      error: function(err) {
        console.error('Papa.parse error:', err);
        $('#cardsContainer').html('<div class="col-12 text-center py-5 text-danger"><h5>Error loading data</h5><p>Check console.</p></div>');
      }
    });
    
    // Live filtering
    $('#searchInput').on('input', applyFilters);
    $('#typeFilter, #sectorFilter').on('change', applyFilters);
    </script>
</body>
</html>